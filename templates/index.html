<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ _('Diabetes Prediction') }} | {{ _('Diabetes Care') }}</title>
    <link
      rel="icon"
      href="{{ url_for('static', filename='stethoscope.png') }}"
      type="image/png"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = { darkMode: "class" };
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script>
      (function () {
        var savedTheme = localStorage.getItem("theme");
        var prefersDark = window.matchMedia(
          "(prefers-color-scheme: dark)"
        ).matches;
        if (savedTheme === "dark" || (!savedTheme && prefersDark)) {
          document.documentElement.classList.add("dark");
        }
      })();
    </script>
    <style>
      * {
        transition: background-color 0.3s ease, border-color 0.3s ease;
      }
      .glass-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
      .dark .glass-card {
        background: rgba(30, 41, 59, 0.95);
        border: 1px solid rgba(148, 163, 184, 0.2);
      }
      .fade-in {
        animation: fadeIn 0.6s ease-out forwards;
        opacity: 0;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .theme-toggle:hover {
        transform: rotate(15deg) scale(1.1);
      }
      .input-field:focus {
        transform: scale(1.01);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
      }
      @media print {
        body > *:not(#printableReport) {
          display: none !important;
        }

        #printableReport {
          display: block !important;
          position: static !important;
          height: auto !important;
          min-height: auto !important;
          page-break-after: avoid !important;
        }
        body {
    padding-top: 100px; /* Space for navbar */
    overflow-x: hidden; /* Prevent horizontal scroll on mobile */
  }
  .nav-floating {
    position: fixed;
    top: 20px;
    z-index: 9999; /* Ensure it stays above everything */
  }
        html,
        body {
          height: auto !important;
          overflow: visible !important;
        }
      }
    </style>
  </head>

  <body
    class="min-h-screen bg-gray-50 dark:bg-slate-950 transition-colors duration-300"
  >
    <!-- Navbar -->
    <nav
      class="bg-gradient-to-r from-blue-600 to-indigo-700 dark:from-slate-800 dark:to-slate-900 text-white shadow-lg sticky top-0 z-50"
    >
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
          <a href="/" class="flex items-center gap-2">
            <span class="text-2xl">‚öïÔ∏è</span>
            <span class="text-xl font-bold"
              >Diabetes<span class="text-cyan-300">Care</span></span
            >
          </a>
          <div class="hidden md:flex items-center gap-6">
            <a href="/" class="hover:text-cyan-300 transition font-medium"
              >{{ _('Home') }}</a
            >
            <a href="/index" class="text-cyan-300 font-bold"
              >{{ _('Prediction') }}</a
            >
            <a href="/life" class="hover:text-cyan-300 transition font-medium"
              >{{ _('Lifestyle') }}</a
            >
            <a
              href="/chatbot"
              class="hover:text-cyan-300 transition font-medium"
              >{{ _('Chatbot') }}</a
            >
            <a
              href="/explore"
              class="hover:text-cyan-300 transition font-medium"
              >{{ _('Explore') }}</a
            >
            <a href="/forum" class="hover:text-cyan-300 transition font-medium"
              >{{ _('Forum') }}</a
            >
          </div>
          <div class="flex items-center gap-3">
            <button
              onclick="toggleTheme()"
              class="theme-toggle p-2 rounded-lg hover:bg-white/10 transition"
              aria-label="Toggle dark mode"
            >
              <svg
                id="theme-icon-sun"
                class="w-5 h-5 hidden"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
                />
              </svg>
              <svg
                id="theme-icon-moon"
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
                />
              </svg>
            </button>
          </div>
        </div>
      </div>
    </nav>

    <!-- Hero Section -->
    <section
      class="bg-gradient-to-br from-blue-600 via-indigo-600 to-cyan-500 dark:from-slate-800 dark:via-slate-900 dark:to-slate-800 py-12"
    >
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <div class="fade-in">
          <div
            class="inline-flex items-center justify-center w-16 h-16 bg-white/20 rounded-2xl mb-4"
          >
            <svg
              class="w-8 h-8 text-white"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"
              />
            </svg>
          </div>
          <h1 class="text-3xl md:text-4xl font-bold text-white mb-3">
            {{ _('Diabetes Prediction') }}
          </h1>
          <p class="text-blue-100 text-lg max-w-2xl mx-auto">
            {{ _('Enter your health metrics to get an AI-powered diabetes risk
            assessment') }}
          </p>
        </div>
      </div>
    </section>

    <!-- Main Content -->
    <main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
      <div class="grid lg:grid-cols-3 gap-8">
        <!-- Form Section -->
        <div class="lg:col-span-2">
          <div class="glass-card rounded-2xl shadow-xl overflow-hidden fade-in">
            <div
              class="bg-gradient-to-r from-blue-600 to-indigo-600 dark:from-indigo-700 dark:to-purple-800 px-6 py-4"
            >
              <div class="flex items-center gap-3">
                <div
                  class="w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center"
                >
                  <svg
                    class="w-5 h-5 text-white"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                    />
                  </svg>
                </div>
                <div>
                  <h2 class="text-xl font-bold text-white">
                    {{ _('Health Metrics') }}
                  </h2>
                  <p class="text-blue-100 text-sm">
                    {{ _('Enter your values for prediction') }}
                  </p>
                </div>
              </div>
            </div>

            <form
              action="/predict"
              method="post"
              onsubmit="storeInputs()"
              class="p-6 bg-white dark:bg-slate-900"
            >
              <div class="grid md:grid-cols-2 gap-5">
                <!-- Pregnancies -->
                <div>
                  <label
                    for="Pregnancies"
                    class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2"
                    >{{ _('Pregnancies') }}</label
                  >
                  <input
                    type="number"
                    id="Pregnancies"
                    name="Pregnancies"
                    placeholder="e.g., 2"
                    required
                    min="0"
                    class="input-field w-full px-4 py-3 bg-gray-50 dark:bg-slate-800 border-2 border-gray-200 dark:border-slate-700 rounded-xl focus:border-blue-500 dark:focus:border-blue-400 outline-none transition text-gray-800 dark:text-white"
                  />
                </div>

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{{ _('Diabetes Prediction') }} | {{ _('Diabetes Care') }}</title>

  <link rel="icon" href="{{ url_for('static', filename='stethoscope.png') }}" type="image/png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <script src="https://cdn.tailwindcss.com"></script>

  <script>
    tailwind.config = { darkMode: "class" };
    (function () {
      const t = localStorage.getItem("theme");
      if (t === "dark" || (!t && window.matchMedia("(prefers-color-scheme: dark)").matches)) {
        document.documentElement.classList.add("dark");
      }
    })();
  </script>

  <style>
    .glass-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
    }

    .dark .glass-card {
      background: rgba(30, 41, 59, 0.95);
    }

    .scroll-to-top {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 50px;
      height: 50px;
      background: #8b5cf6;
      color: #fff;
      border-radius: 50%;
      display: none;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      cursor: pointer;
      z-index: 1000;
    }

    .scroll-to-top.show {
      display: flex;
    }
  </style>
</head>

<body class="min-h-screen bg-gray-50 dark:bg-slate-950 transition-colors">

  <!-- Navbar -->
  <nav class="bg-gradient-to-r from-blue-600 to-indigo-700 dark:from-slate-800 dark:to-slate-900 text-white sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-6 h-16 flex justify-between items-center">
      <a href="/" class="font-bold text-xl">‚öïÔ∏è Diabetes<span class="text-cyan-300">Care</span></a>
      <div class="hidden md:flex gap-6">
        <a href="/" class="hover:text-cyan-300">{{ _('Home') }}</a>
        <a href="/index" class="text-cyan-300 font-bold">{{ _('Prediction') }}</a>
        <a href="/life" class="hover:text-cyan-300">{{ _('Lifestyle') }}</a>
        <a href="/chatbot" class="hover:text-cyan-300">{{ _('Chatbot') }}</a>
        <a href="/explore" class="hover:text-cyan-300">{{ _('Explore') }}</a>
        <a href="/forum" class="hover:text-cyan-300">{{ _('Forum') }}</a>
      </div>
    </div>
  </nav>

  <!-- Hero -->
  <section class="bg-gradient-to-br from-blue-600 via-indigo-600 to-cyan-500 dark:from-slate-800 dark:to-slate-900 py-12 text-center text-white">
    <h1 class="text-4xl font-bold mb-3">{{ _('Diabetes Prediction') }}</h1>
    <p class="text-blue-100">{{ _('Enter your health metrics to get an AI-powered assessment') }}</p>
  </section>

  <!-- Main -->
  <main class="max-w-6xl mx-auto px-4 py-10">
    <div class="grid lg:grid-cols-3 gap-8">

      <!-- Form -->
      <div class="lg:col-span-2 glass-card rounded-2xl shadow-xl p-6">
        <form id="predictionForm" action="/predict" method="post" class="grid md:grid-cols-2 gap-5">

          {% for f,l,p in [
            ('Pregnancies','Pregnancies','2'),
            ('Glucose','Glucose Level','130'),
            ('BloodPressure','Blood Pressure','70'),
            ('SkinThickness','Skin Thickness','32'),
            ('Insulin','Insulin Level','85'),
            ('BMI','BMI','28.5'),
            ('DiabetesPedigreeFunction','Diabetes Pedigree','0.45'),
            ('Age','Age','35')
          ] %}

          <div>
            <label class="block mb-2 font-semibold text-gray-700 dark:text-gray-300">{{ _(l) }}</label>
            <input
              type="number"
              step="any"
              name="{{ f }}"
              id="{{ f }}"
              required
              min="0"
              placeholder="e.g. {{ p }}"
              class="w-full px-4 py-3 bg-gray-50 dark:bg-slate-800 border-2 border-gray-200 dark:border-slate-700 rounded-xl text-gray-800 dark:text-white focus:border-blue-500 outline-none"
            />
          </div>

          {% endfor %}

          <button type="submit"
            class="md:col-span-2 mt-4 py-4 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-bold rounded-xl transition">
            {{ _('Get Prediction') }}
          </button>

        </form>
      </div>

      <!-- Sidebar -->
      <div class="space-y-4">
        <div class="glass-card p-5 rounded-2xl shadow-lg">
          <h3 class="font-bold mb-3 text-gray-800 dark:text-white">{{ _('Quick Links') }}</h3>

          <a href="/dashboard" class="block p-3 rounded-xl bg-blue-50 dark:bg-slate-800 hover:bg-blue-100 dark:hover:bg-slate-700 mb-2">
            üìä {{ _('View Dashboard') }}
          </a>

          <a href="/life" class="block p-3 rounded-xl bg-cyan-50 dark:bg-slate-800 hover:bg-cyan-100 dark:hover:bg-slate-700 mb-2">
            üí™ {{ _('Lifestyle Check') }}
          </a>

          <a href="/explore" class="block p-3 rounded-xl bg-indigo-50 dark:bg-slate-800 hover:bg-indigo-100 dark:hover:bg-slate-700">
            üîç {{ _('Explore Data') }}
          </a>
        </div>
      </div>

    </div>

    {% if prediction_text %}
    <div class="mt-8 glass-card rounded-2xl p-6 text-center shadow-xl">
      <h2 class="text-xl font-bold mb-2">{{ _('Prediction Result') }}</h2>
      <p id="predictionResult">{{ prediction_text }}</p>
      <a href="/dashboard" class="inline-block mt-4 px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg">
        {{ _('View History') }}
      </a>
    </div>
    {% endif %}
  </main>

  <!-- Scroll Button -->
  <button class="scroll-to-top" id="scrollToTop" onclick="window.scrollTo({top:0,behavior:'smooth'})">
    <i class="fas fa-arrow-up"></i>
  </button>

      // Print and PDF functions
      function getInputValues() {
        return {
          Pregnancies: document.getElementById("Pregnancies")?.value || "N/A",
          "Glucose Level": document.getElementById("Glucose")?.value || "N/A",
          "Blood Pressure":
            document.getElementById("BloodPressure")?.value || "N/A",
          "Skin Thickness":
            document.getElementById("SkinThickness")?.value || "N/A",
          "Insulin Level": document.getElementById("Insulin")?.value || "N/A",
          BMI: document.getElementById("BMI")?.value || "N/A",
          "Diabetes Pedigree":
            document.getElementById("DiabetesPedigreeFunction")?.value || "N/A",
          Age: document.getElementById("Age")?.value || "N/A",
        };
      }
      function formatDate() {
        return new Date().toLocaleString("en-US", {
          year: "numeric",
          month: "long",
          day: "numeric",
          hour: "2-digit",
          minute: "2-digit",
        });
      }
      function storeInputs() {
        const values = getInputValues();
        sessionStorage.setItem("reportInputs", JSON.stringify(values));
      }

      function prepareReport() {
        var reportDate = document.getElementById("reportDate");
        var reportInputValues = document.getElementById("reportInputValues");
        if (reportDate) reportDate.textContent = "Date: " + formatDate();
        if (reportInputValues) {
          const values = JSON.parse(
            sessionStorage.getItem("reportInputs") || "{}"
          );

          reportInputValues.innerHTML = Object.entries(values)
            .map(function (entry) {
              return (
                "<li><strong>" + entry[0] + ":</strong> " + entry[1] + "</li>"
              );
            })
            .join("");
        }
        sessionStorage.removeItem("reportInputs");
      }

      function printReport() {
        prepareReport();
        var printableReport = document.getElementById("printableReport");
        if (printableReport) {
          printableReport.classList.remove("hidden");
          window.print();
          setTimeout(function () {
            printableReport.classList.add("hidden");
          }, 100);
        }
      }
      function downloadPDF() {
        prepareReport();
        var printableReport = document.getElementById("printableReport");
        if (printableReport && typeof html2pdf !== "undefined") {
          printableReport.classList.remove("hidden");
          const opt = {
            margin: 5,
            filename: "diabetes-prediction-report.pdf",
            image: { type: "jpeg", quality: 0.95 },
            html2canvas: { scale: 1.5, scrollY: 0 },
            jsPDF: { unit: "mm", format: "a4", orientation: "portrait" },
          };

          html2pdf()
            .set({
              margin: 5,
              html2canvas: { scale: 1.2 },
              jsPDF: { unit: "mm", format: "a4" },
            })
            .from(document.getElementById("printableReport"))
            .save();
        } else {
          alert("PDF generation is not available.");
        }
      }
    

    // Email Report Functions
    function toggleEmailForm() {
      const container = document.getElementById('emailFormContainer');
      if (container) {
        container.classList.toggle('hidden');
        if (!container.classList.contains('hidden')) {
          document.getElementById('emailInput').focus();
        }
      }
    }

    function setEmailLoading(loading) {
      const btn = document.getElementById('sendEmailBtn');
      const text = document.getElementById('sendEmailText');
      const spinner = document.getElementById('sendEmailSpinner');
      
      if (btn && text && spinner) {
        btn.disabled = loading;
        text.textContent = loading ? '{{ _("Sending...") }}' : '{{ _("Send") }}';
        spinner.classList.toggle('hidden', !loading);
      }
    }

    function showEmailStatus(message, isError) {
      const status = document.getElementById('emailStatus');
      if (status) {
        status.textContent = message;
        status.className = 'mt-3 text-sm ' + (isError ? 'text-red-600' : 'text-green-600');
        status.classList.remove('hidden');
        
        // Auto-hide success messages
        if (!isError) {
          setTimeout(() => {
            status.classList.add('hidden');
            document.getElementById('emailFormContainer').classList.add('hidden');
          }, 3000);
        }
      }
    }

    async function sendEmailReport() {
      const emailInput = document.getElementById('emailInput');
      const email = emailInput ? emailInput.value.trim() : '';
      
      if (!email) {
        showEmailStatus('{{ _("Please enter an email address") }}', true);
        return;
      }
      
      // Basic email validation
      if (!email.includes('@') || !email.includes('.')) {
        showEmailStatus('{{ _("Please enter a valid email address") }}', true);
        return;
      }
      
      const predictionResult = document.getElementById('predictionResult');
      if (!predictionResult) {
        showEmailStatus('{{ _("No prediction result to send") }}', true);
        return;
      }
      
      setEmailLoading(true);
      
      try {
        const response = await fetch('/api/send-prediction-email', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            email: email,
            prediction: predictionResult.textContent.trim(),
            inputValues: getInputValues()
          })
        });
        
        const data = await response.json();
        
        if (response.ok && data.success) {
          showEmailStatus('{{ _("Report sent successfully!") }}', false);
          emailInput.value = '';
        } else {
          showEmailStatus(data.error || '{{ _("Failed to send email") }}', true);
        }
      } catch (error) {
        console.error('Email send error:', error);
        showEmailStatus('{{ _("Failed to send email. Please try again.") }}', true);
      } finally {
        setEmailLoading(false);
      }
    }

    // Allow Enter key to send email
    document.addEventListener('DOMContentLoaded', function() {
      const emailInput = document.getElementById('emailInput');
      if (emailInput) {
        emailInput.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            e.preventDefault();
            sendEmailReport();
          }
        });
      }
    });
  </script>

</body>
</html>
